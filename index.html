<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sportsbook Master Ticker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        /* MASTER SCALING */
        :root { --ticker-height: 16vh; }

        body, html { 
            margin: 0; padding: 0; width: 100vw; height: 100vh; 
            background: black; overflow: hidden; color: white; 
            font-family: 'Inter', sans-serif; cursor: none; font-size: 2.0vh; 
        }
        
        body.remote-active .tv-wrapper { display: none !important; }
        body:not(.remote-active) #remote-controller { display: none !important; }

        .tv-wrapper { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }

        /* FULL SCREEN TOGGLE BTN */
        #fs-toggle {
            position: fixed;
            top: 2vh;
            right: 2vw;
            z-index: 10000;
            background: rgba(0, 0, 0, 0.5);
            color: #fff;
            border: 1px solid #333;
            padding: 1vh 1.5vh;
            font-size: 2.5vh;
            cursor: pointer;
            border-radius: 0.5vh;
            opacity: 0.3; /* Faded by default */
            transition: all 0.3s ease;
        }
        #fs-toggle:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.9);
            border-color: #ff007f;
            color: #ff007f;
            box-shadow: 0 0 15px rgba(255, 0, 127, 0.5);
        }

        /* TICKER */
        #sports-ticker { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: var(--ticker-height); 
            background: rgba(0,0,0,0.95); backdrop-filter: blur(20px); 
            border-top: 0.4vh solid #ff007f; z-index: 100; 
            display: flex; align-items: center; overflow: hidden; white-space: nowrap; 
            box-shadow: 0 -1vh 3vh rgba(255, 0, 127, 0.6); 
        }
        #ticker-track { display: inline-flex; animation: scrollTicker 60s linear infinite; padding-left: 100%; height: 100%; align-items: center; } 
        .ticker-section-head { display: inline-flex; align-items: center; justify-content: center; padding: 0 3vw; height: 100%; color: #ff007f; font-size: 3rem; letter-spacing: 0.3vw; font-weight: 900; vertical-align: middle; }
        .live-mode-header { display: inline-flex; align-items: center; justify-content: center; padding: 0 2vw; height: 100%; color: #ff007f; font-size: 3rem; font-weight: 900; vertical-align: middle; margin-right: 1vw; }
        .score-item, .news-item { display: inline-flex; align-items: center; padding: 0 4vw; border-right: 1px solid #333; height: 100%; vertical-align: middle; }
        .news-item { color: #00ffff; font-family: 'Inter', sans-serif; font-size: 2.8rem; font-weight: 700; }
        .news-tag { background: #ff007f; color: black; font-size: 1.5rem; padding: 0.5vh 1vh; margin-right: 1.5vw; border-radius: 4px; font-weight: 900; }
        .team-box { display: flex; align-items: center; flex-wrap: nowrap; }
        .team-logo { width: 8vh; height: 8vh; object-fit: contain; margin-right: 1vw; flex-shrink: 0; } 
        .team-score { font-size: 3.5rem; line-height: 1; color: #00ffff; margin-right: 0.5vw; font-weight: 900; }
        .vs-label { color: #444; font-size: 2rem; margin: 0 2vw; font-weight: bold; }
        .game-status { margin-left: 1.5vw; color: #facc15; font-size: 2rem; text-transform: uppercase; letter-spacing: 0.1vw; }
        .game-stats { margin-left: 3vw; display: flex; flex-direction: row; gap: 2vw; align-items: center; color: #aaa; font-size: 2.2rem; border-left: 0.2vh solid #333; padding-left: 1.5vw; }
        .stat-cat { color: #facc15; font-weight: 800; text-transform: uppercase; font-size: 1.6rem; margin-right: 0.5vw; }
        .live-pulse { animation: pulseRed 1s infinite; color: #ff0000; font-weight: 900; margin-right: 1vw; font-size: 2rem; }
        @keyframes pulseRed { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }
        @keyframes scrollTicker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* BACKGROUND */
        #main-bg { position: absolute; inset: 0; z-index: 0; background: #050505; overflow: hidden; perspective: 100vh; }
        .cyber-grid { position: absolute; top: 0; left: -50%; width: 200%; height: 100%; background-image: linear-gradient(rgba(0, 255, 255, 0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 255, 0.3) 1px, transparent 1px); background-size: 100px 100px; transform: rotateX(45deg); transform-origin: 50% 50%; animation: gridMove 20s linear infinite; mask-image: linear-gradient(to bottom, transparent 10%, black 90%); }
        @keyframes gridMove { 0% { background-position: 0 0; } 100% { background-position: 0 1000px; } }
        .scanlines { position: absolute; inset: 0; pointer-events: none; z-index: 2; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2)); background-size: 100% 4px; }
        .vignette { position: absolute; inset: 0; pointer-events: none; z-index: 3; background: radial-gradient(circle, transparent 50%, black 100%); }

        /* SLIDES */
        .slide-screen { position: absolute; inset: 0; z-index: 10; display: none; flex-direction: column; padding: 2vh 4vh; font-family: 'Share Tech Mono', monospace; align-items: center; overflow: hidden; }
        .screen-header { font-size: 7vh; font-weight: 900; color: #fff; text-transform: uppercase; letter-spacing: 1vh; margin-bottom: 2vh; margin-top: 2vh; text-shadow: 0 0 15px rgba(0, 255, 255, 0.9); z-index: 20; border-bottom: 0.5vh solid #00ffff; padding-bottom: 1vh; width: 95%; text-align: center; }
        .content-viewport { width: 95%; height: 68vh; overflow: hidden; position: relative; z-index: 20; padding-bottom: var(--ticker-height); }

        /* GRIDS & LISTS */
        .grid-track { display: grid; grid-template-columns: repeat(2, 1fr); gap: 2vw; padding-bottom: 10vh; }
        .info-card { background: rgba(0, 20, 30, 0.85); border: 1px solid #00aaaa; border-left: 0.8vh solid #00ffff; border-radius: 0.8vh; display: flex; flex-direction: column; padding: 2.5vh; box-shadow: 0 0 2vh rgba(0, 255, 255, 0.1); backdrop-filter: blur(5px); }
        .live-card { border: 1px solid #ff0000; border-left: 0.8vh solid #ff0000; box-shadow: 0 0 2vh rgba(255, 0, 0, 0.2); }
        .card-meta { display: flex; justify-content: space-between; border-bottom: 1px solid #004444; padding-bottom: 1vh; margin-bottom: 1.5vh; font-size: 1.8vh; color: #00aaaa; font-weight: bold; }
        .meta-tag { color: #fff; background: #004444; padding: 0 1vw; border-radius: 0.3vh; }
        .card-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.2vh; }
        .card-team { display: flex; align-items: center; gap: 1.5vh; font-size: 3vh; font-weight: 700; color: white; text-shadow: 0 0 0.5vh rgba(0,0,0,0.5); } 
        .card-team img { width: 5vh; height: 5vh; object-fit: contain; } 
        .card-val-lg { font-weight: bold; color: #facc15; font-size: 3vh; text-shadow: 0 0 1vh rgba(250, 204, 21, 0.3); } 
        .card-footer { margin-top: auto; padding-top: 1vh; border-top: 1px dashed #004444; display: flex; justify-content: space-between; align-items: center; color: #aaa; font-size: 2vh; }
        .card-val-sm { color: #00ff00; font-weight: bold; font-size: 2.5vh; }

        /* COLLEGE RANKINGS (RESTORED LIST STYLES) */
        .list-track { display: flex; flex-direction: column; gap: 1vh; padding-bottom: 10vh; width: 80%; margin: 0 auto; }
        .rank-header-row { color: #00ffff; font-size: 4vh; font-weight: bold; margin: 3vh 0 1vh 0; border-bottom: 2px solid #00ffff; text-shadow: 0 0 1vh #00ffff; }
        .rank-row { display: flex; align-items: center; background: rgba(0, 20, 30, 0.9); border-left: 0.8vh solid #facc15; border-bottom: 1px solid #333; padding: 1.5vh 2vh; border-radius: 0.5vh; }
        .rank-num { font-size: 5vh; color: #facc15; font-weight: 900; width: 10vh; text-align: center; margin-right: 2vh; }
        .rank-logo { width: 8vh; height: 8vh; object-fit: contain; margin-right: 3vh; }
        .rank-name { font-size: 4vh; color: white; font-weight: bold; flex: 1; text-transform: uppercase; letter-spacing: 2px; }
        .rank-rec { font-size: 3vh; color: #aaa; font-weight: bold; }

        /* PRO STANDINGS (GRID STYLES) */
        .standings-track { display: grid; grid-template-columns: 1fr 1fr; gap: 2vw; width: 100%; padding-bottom: 15vh; }
        .division-block { background: rgba(0, 20, 30, 0.7); border: 1px solid #333; border-radius: 1vh; padding: 1.5vh; margin-bottom: 2vh; }
        .division-header { color: #facc15; font-size: 2.5vh; font-weight: 900; text-transform: uppercase; border-bottom: 2px solid #00aaaa; margin-bottom: 1vh; padding-bottom: 0.5vh; text-shadow: 0 0 10px rgba(250, 204, 21, 0.5); }
        .st-row { display: flex; align-items: center; padding: 0.8vh 0; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 2.2vh; }
        .st-rank { width: 3vh; color: #aaa; font-weight: bold; text-align: right; margin-right: 1.5vh; }
        .st-logo { width: 3.5vh; height: 3.5vh; object-fit: contain; margin-right: 1vh; }
        .st-name { flex: 1; color: white; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .st-rec { color: #00ffff; font-weight: bold; }

        /* NEWS */
        #news-display { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 0; position: relative; }
        #news-bg-image { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.4; mask-image: linear-gradient(to bottom, black 0%, transparent 20%, black 100%); z-index: 0; filter: grayscale(0.5); transition: opacity 1s; }
        .news-overlay { z-index: 5; background: rgba(0, 0, 0, 0.85); padding: 6vh; border-left: 1vh solid #ff007f; border-radius: 2vh; width: 80%; text-align: center; margin-bottom: 5vh; box-shadow: 0 0 50px rgba(0,0,0,0.8); }
        #news-headline { font-size: 6vh; font-weight: 900; color: white; line-height: 1.1; margin-bottom: 3vh; text-transform: uppercase; }
        #news-body { font-size: 3.5vh; color: #ccc; font-family: 'Inter', sans-serif; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical; overflow: hidden; }

        @keyframes scrollVerticalOnePass { 0% { transform: translateY(0); } 100% { transform: translateY(var(--scroll-end)); } }

        /* REMOTE */
        #remote-controller { position: fixed; inset: 0; z-index: 9999; background: #000; display: flex; flex-direction: column; font-family: 'Inter', sans-serif; color: white; cursor: default; overflow: hidden; font-size: 16px; }
        .r-btn { width: 100%; padding: 20px; margin-bottom: 10px; background: #1a1a1a; border: 1px solid #333; color: white; font-weight: bold; border-radius: 8px; }
    </style>
</head>
<body onmousemove="showCursor()">

    <div class="tv-wrapper" id="main-wrapper">
        <div id="main-bg"><div class="cyber-grid"></div><div class="scanlines"></div><div class="vignette"></div></div>

        <button id="fs-toggle" onclick="toggleFullscreen()">⛶</button>

        <div id="live-game-screen" class="slide-screen">
            <div class="screen-header" style="color: #ff0000; text-shadow: 0 0 15px red; border-bottom-color: red;">LIVE ACTION</div>
            <div class="content-viewport" id="live-viewport"><div class="grid-track" id="live-grid-track"></div></div>
        </div>

        <div id="odds-screen" class="slide-screen"><div class="screen-header">TODAY'S LINES</div><div class="content-viewport" id="odds-viewport"><div class="grid-track" id="odds-grid-track"></div></div></div>
        
        <div id="rankings-screen" class="slide-screen"><div class="screen-header">COLLEGE RANKINGS</div><div class="content-viewport" id="rankings-viewport"><div class="list-track" id="rankings-list-track"></div></div></div>
        
        <div id="nfl-screen" class="slide-screen"><div class="screen-header">NFL STANDINGS</div><div class="content-viewport" id="nfl-viewport"><div class="standings-track" id="nfl-track"></div></div></div>
        
        <div id="news-screen" class="slide-screen" style="padding:0;"><img id="news-bg-image" src=""><div id="news-display"><div class="news-overlay"><div class="screen-header" style="text-align: center; width: 100%; margin:0 0 3vh 0; border:none; padding:0; font-size: 4vh; color:#ff007f;">TOP STORIES</div><div id="news-headline">Loading News...</div><div id="news-body"></div></div></div></div>
        
        <div id="nba-screen" class="slide-screen"><div class="screen-header">NBA STANDINGS</div><div class="content-viewport" id="nba-viewport"><div class="standings-track" id="nba-track"></div></div></div>
        <div id="nhl-screen" class="slide-screen"><div class="screen-header">NHL STANDINGS</div><div class="content-viewport" id="nhl-viewport"><div class="standings-track" id="nhl-track"></div></div></div>
        <div id="mlb-screen" class="slide-screen"><div class="screen-header">MLB STANDINGS</div><div class="content-viewport" id="mlb-viewport"><div class="standings-track" id="mlb-track"></div></div></div>

        <div id="sports-ticker"><div id="ticker-track">Loading Sports Data...</div></div>
    </div>

    <div id="remote-controller">
        <div class="p-4 bg-zinc-900 border-b border-zinc-800 font-bold text-center text-cyan-400">MASTER CONTROL</div>
        <div class="p-4">
             <button class="r-btn" onclick="toggleFullscreen()">Toggle Fullscreen</button>
             <button class="r-btn" onclick="bcSend('forceNext')">Next Slide >></button>
        </div>
    </div>

    <script>
        // --- CORE VARIABLES ---
        const bc = new BroadcastChannel('cinema_channel');
        let rotationStep = 0; 
        let slideTimer;
        let cursorTimer;
        let currentNewsIndex = 0;
        let newsData = [];
        let areGamesActive = false; 
        let globalLiveGamesData = []; 
        let showingLiveInterstitial = false;

        function checkMode() { if (window.location.hash === '#remote') { document.body.classList.add('remote-active'); document.body.style.cursor = 'default'; } else { document.body.classList.remove('remote-active'); } }
        window.addEventListener('hashchange', checkMode); window.addEventListener('load', checkMode);
        function bcSend(action, ...args) { if (document.body.classList.contains('remote-active')) bc.postMessage({ action, args }); else executeLocal(action, args); }
        bc.onmessage = (ev) => { if (!document.body.classList.contains('remote-active')) executeLocal(ev.data.action, ev.data.args); };
        function executeLocal(action, args) { if (action === 'toggleFullscreen') toggleFullscreen(); if (action === 'forceNext') { clearTimeout(slideTimer); nextSlide(); } }
        function toggleFullscreen() { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }
        function showCursor() { document.body.style.cursor = 'default'; clearTimeout(cursorTimer); cursorTimer = setTimeout(()=>document.body.style.cursor='none', 3000); }

        function isLeagueActive(league) {
            const m = new Date().getMonth(); 
            if (league === 'nfl') return (m >= 7 || m <= 1);
            if (league === 'nba' || league === 'nhl') return (m >= 9 || m <= 5);
            if (league === 'mlb') return (m >= 2 && m <= 10);
            if (league === 'cfb' || league === 'cbb') return (m >= 7 || m <= 3);
            return false;
        }

        function nextSlide() {
            clearTimeout(slideTimer);
            if (areGamesActive && !showingLiveInterstitial) { renderLivePage(); showingLiveInterstitial = true; return; }
            showingLiveInterstitial = false; 
            if (rotationStep > 6) rotationStep = 0;
            if (rotationStep === 0) showOdds(); 
            else if (rotationStep === 1) { if(isLeagueActive('cfb') || isLeagueActive('cbb')) showRankings(); else { rotationStep++; nextSlide(); } } 
            else if (rotationStep === 2) { if(isLeagueActive('nfl')) showStandings('nfl', 'football'); else { rotationStep++; nextSlide(); } } 
            else if (rotationStep === 3) showNews(); 
            else if (rotationStep === 4) { if(isLeagueActive('nba')) showStandings('nba', 'basketball'); else { rotationStep++; nextSlide(); } } 
            else if (rotationStep === 5) { if(isLeagueActive('nhl')) showStandings('nhl', 'hockey'); else { rotationStep++; nextSlide(); } } 
            else if (rotationStep === 6) { if(isLeagueActive('mlb')) showStandings('mlb', 'baseball'); else { rotationStep = 0; nextSlide(); } } 
        }
        function advanceSlide() { rotationStep++; nextSlide(); }

        function renderLivePage() {
            document.querySelectorAll('.slide-screen').forEach(el => el.style.display = 'none');
            document.getElementById('live-game-screen').style.display = 'flex';
            const track = document.getElementById('live-grid-track');
            track.innerHTML = globalLiveGamesData.map(g => `<div class="info-card live-card"><div class="card-meta"><span style="color:#ff0000">● LIVE</span><span class="meta-tag">${g.league}</span><span class="meta-tag" style="color:#facc15">${g.status}</span></div><div class="card-row"><div class="card-team"><img src="${g.awayLogo}">${g.away}</div><div class="card-val-lg">${g.awayScore}</div></div><div class="card-row"><div class="card-team"><img src="${g.homeLogo}">${g.home}</div><div class="card-val-lg">${g.homeScore}</div></div><div class="card-footer"><span style="color:#aaa">${g.clock || 'In Progress'}</span><span class="card-val-sm">${g.tv}</span></div></div>`).join('');
            const viewH = document.getElementById('live-viewport').clientHeight; const fullH = track.scrollHeight;
            if (fullH > viewH) {
                const scrollDist = fullH - viewH + 50; const duration = scrollDist / 50; 
                track.style.setProperty('--scroll-end', `-${scrollDist}px`);
                track.style.animation = `scrollVerticalOnePass ${duration}s linear 2s forwards`;
                slideTimer = setTimeout(nextSlide, 2000 + (duration * 1000) + 3000);
            } else { slideTimer = setTimeout(nextSlide, 12000); }
        }

        async function fetchOddsData() {
            let configs = [];
            if(isLeagueActive('nfl')) configs.push({ l: 'nfl', s: 'football' });
            if(isLeagueActive('nba')) configs.push({ l: 'nba', s: 'basketball' });
            if(isLeagueActive('nhl')) configs.push({ l: 'nhl', s: 'hockey' });
            if(isLeagueActive('mlb')) configs.push({ l: 'mlb', s: 'baseball' });
            if(isLeagueActive('cbb')) configs.push({ l: 'mens-college-basketball', s: 'basketball' });
            let allGames = [];
            const now = new Date(), tomorrow = new Date(now.getTime() + 86400000);
            for (const c of configs) {
                try {
                    let url = `https://site.api.espn.com/apis/site/v2/sports/${c.s}/${c.l}/scoreboard`;
                    const res = await fetch(url);
                    const d = await res.json();
                    d.events.forEach(ev => {
                        const comp = ev.competitions[0];
                        const gTime = new Date(ev.date);
                        if (gTime > now && gTime < tomorrow && comp.status.type.state === 'pre') {
                            allGames.push({ league: c.l.toUpperCase(), time: gTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}), home: { name: comp.competitors[0].team.shortDisplayName, logo: comp.competitors[0].team.logo }, away: { name: comp.competitors[1].team.shortDisplayName, logo: comp.competitors[1].team.logo }, details: comp.odds ? comp.odds[0].details : 'EVEN', overUnder: comp.odds ? comp.odds[0].overUnder : '--', channel: (comp.broadcasts && comp.broadcasts[0]) ? comp.broadcasts[0].names[0] : 'TV TBA' });
                        }
                    });
                } catch(e) {}
            }
            return allGames;
        }

        async function showOdds() {
            const games = await fetchOddsData();
            if (games.length === 0) { advanceSlide(); return; }
            document.querySelectorAll('.slide-screen').forEach(el => el.style.display = 'none');
            document.getElementById('odds-screen').style.display = 'flex';
            const track = document.getElementById('odds-grid-track');
            track.innerHTML = games.map(g => `<div class="info-card"><div class="card-meta"><span>${g.league}</span><span class="meta-tag">${g.channel}</span><span class="meta-tag" style="color:#facc15">${g.time}</span></div><div class="card-row"><div class="card-team"><img src="${g.away.logo}">${g.away.name}</div><div class="card-val-lg">${g.details.includes(g.away.name) ? g.details.replace(g.away.name, '') : ''}</div></div><div class="card-row"><div class="card-team"><img src="${g.home.logo}">${g.home.name}</div><div class="card-val-lg">${g.details.includes(g.home.name) ? g.details.replace(g.home.name, '') : (g.details.includes(g.away.name) ? '' : g.details)}</div></div><div class="card-footer"><span>TOTAL</span><span class="card-val-sm">O/U ${g.overUnder}</span></div></div>`).join('');
            const viewH = document.getElementById('odds-viewport').clientHeight;
            if (track.scrollHeight > viewH) {
                const scrollDuration = (games.length / 2) * 7; const scrollAmt = -(track.scrollHeight - viewH + 100); 
                track.style.setProperty('--scroll-end', `${scrollAmt}px`);
                track.style.animation = `scrollVerticalOnePass ${scrollDuration}s linear forwards`;
                slideTimer = setTimeout(advanceSlide, (scrollDuration * 1000) + 2000);
            } else { slideTimer = setTimeout(advanceSlide, 15000); }
        }

        // --- UPDATED COLLEGE RANKINGS FETCH ---
        async function fetchRankings() {
            const sources = [
                { url: 'https://site.api.espn.com/apis/site/v2/sports/football/college-football/rankings', label: 'COLLEGE FOOTBALL RANKINGS', active: isLeagueActive('cfb') },
                { url: 'https://site.api.espn.com/apis/site/v2/sports/basketball/mens-college-basketball/rankings', label: 'COLLEGE BASKETBALL RANKINGS', active: isLeagueActive('cbb') }
            ];
            let combined = [];
            for(const s of sources) {
                if(!s.active) continue; 
                try {
                    const res = await fetch(s.url);
                    const data = await res.json();
                    const poll = data.rankings ? data.rankings[0] : null;
                    if(poll && poll.ranks) {
                        combined.push({ header: s.label }); 
                        poll.ranks.forEach(r => {
                            combined.push({
                                isTeam: true, rank: r.current, team: r.team.nickname || r.team.name, logo: r.team.logo, record: r.recordSummary
                            });
                        });
                    }
                } catch(e) {}
            }
            return combined;
        }

        async function showRankings() {
            const ranks = await fetchRankings();
            if (ranks.length === 0) { advanceSlide(); return; }
            document.querySelectorAll('.slide-screen').forEach(el => el.style.display = 'none');
            document.getElementById('rankings-screen').style.display = 'flex';
            const track = document.getElementById('rankings-list-track');
            track.innerHTML = ranks.map(r => r.header ? `<div class="rank-header-row">${r.header}</div>` : `<div class="rank-row"><div class="rank-num">${r.rank}</div><img class="rank-logo" src="${r.logo}"><div class="rank-name">${r.team}</div><div class="rank-rec">${r.record}</div></div>`).join('');
            const viewH = document.getElementById('rankings-viewport').clientHeight;
            if (track.scrollHeight > viewH) { const scrollDuration = ranks.length * 1.5; const scrollAmt = -(track.scrollHeight - viewH + 100); track.style.setProperty('--scroll-end', `${scrollAmt}px`); track.style.animation = `scrollVerticalOnePass ${scrollDuration}s linear forwards`; slideTimer = setTimeout(advanceSlide, (scrollDuration * 1000) + 2000); } else { slideTimer = setTimeout(advanceSlide, 10000); }
        }

        // --- PRO STANDINGS LOGIC ---
        async function fetchStandingsData(league, sport) {
            try {
                // Primary URL: apis/v2
                const res = await fetch(`https://site.api.espn.com/apis/v2/sports/${sport}/${league}/standings`);
                if (res.ok) return await res.json();
            } catch (e) {}
            return null;
        }

        function extractTeamsFromNode(node) {
            let teams = [];
            if (node.standings && node.standings.entries) {
                node.standings.entries.forEach(entry => {
                    const stats = entry.stats || [];
                    const winPct = stats.find(s => s.name === 'winPercent')?.value || 0;
                    const rec = stats.find(s => s.name === 'record');
                    let recStr = rec ? rec.displayValue : "";
                    if (!recStr) {
                        const w = stats.find(s => s.type === 'wins')?.value || 0;
                        const l = stats.find(s => s.type === 'losses')?.value || 0;
                        recStr = `${w}-${l}`;
                    }
                    teams.push({
                        team: entry.team.displayName,
                        logo: entry.team.logos?.[0]?.href || '',
                        record: recStr,
                        pct: winPct
                    });
                });
            }
            return teams;
        }

        async function showStandings(league, sport) {
            const data = await fetchStandingsData(league, sport);
            if (!data) { advanceSlide(); return; }

            let groups = [];
            
            if (league === 'nba') {
                data.children.forEach(conf => {
                    let confTeams = [];
                    // Aggregation
                    const traverse = (node) => {
                        if(node.standings && node.standings.entries) {
                            confTeams.push(...extractTeamsFromNode(node));
                        }
                        if(node.children) node.children.forEach(traverse);
                    };
                    traverse(conf);
                    confTeams.sort((a, b) => b.pct - a.pct);
                    groups.push({ name: conf.name, teams: confTeams });
                });
            } 
            else {
                // Standard Logic (NFL, NHL, MLB) - Display Divisions
                const traverseDivs = (node) => {
                    if (node.standings && node.standings.entries) {
                        // It's a division
                        let divTeams = extractTeamsFromNode(node);
                        divTeams.sort((a, b) => b.pct - a.pct);
                        groups.push({ name: node.name, teams: divTeams });
                    }
                    if (node.children) node.children.forEach(traverseDivs);
                };
                traverseDivs(data);
            }

            document.querySelectorAll('.slide-screen').forEach(el => el.style.display = 'none');
            const screen = document.getElementById(`${league}-screen`);
            screen.style.display = 'flex';
            const track = document.getElementById(`${league}-track`);

            if (groups.length > 0) {
                let html = "";
                groups.forEach(group => {
                    html += `<div class="division-block"><div class="division-header">${group.name}</div>`;
                    group.teams.forEach((t, i) => {
                        html += `<div class="st-row"><div class="st-rank">${i+1}</div><img class="st-logo" src="${t.logo}"><div class="st-name">${t.team}</div><div class="st-rec">${t.record}</div></div>`;
                    });
                    html += `</div>`;
                });
                track.innerHTML = html;
                
                const viewH = document.getElementById(`${league}-viewport`).clientHeight;
                if (track.scrollHeight > viewH) {
                    const scrollDist = track.scrollHeight - viewH + 100;
                    const duration = scrollDist / 50; 
                    track.style.setProperty('--scroll-end', `-${scrollDist}px`);
                    track.style.animation = `scrollVerticalOnePass ${duration}s linear 2s forwards`;
                    slideTimer = setTimeout(advanceSlide, 2000 + (duration * 1000) + 3000);
                } else { slideTimer = setTimeout(advanceSlide, 10000); }
            } else {
                track.innerHTML = '<div style="text-align:center; padding:50px; color:#666;">DATA UNAVAILABLE</div>';
                slideTimer = setTimeout(advanceSlide, 3000);
            }
        }

        async function fetchNews() { try { const res = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/nfl/news`); const data = await res.json(); return data.articles.slice(0, 5); } catch(e) { return []; } }
        async function showNews() { newsData = await fetchNews(); if (newsData.length === 0) { advanceSlide(); return; } document.querySelectorAll('.slide-screen').forEach(el => el.style.display = 'none'); document.getElementById('news-screen').style.display = 'flex'; currentNewsIndex = 0; cycleNewsItem(); }
        function cycleNewsItem() { if (currentNewsIndex >= newsData.length) { advanceSlide(); return; } const story = newsData[currentNewsIndex]; const bg = document.getElementById('news-bg-image'); const hl = document.getElementById('news-headline'); const bd = document.getElementById('news-body'); bg.style.opacity = 0; setTimeout(() => { bg.src = story.images?.[0]?.url || ''; hl.innerText = story.headline; bd.innerText = story.description || story.story || ""; bg.style.opacity = 0.4; currentNewsIndex++; slideTimer = setTimeout(cycleNewsItem, 10000); }, 500); }

        async function updateSportsTicker() { 
            const configs = [ { l: 'nhl', s: 'hockey' }, { l: 'nfl', s: 'football' }, { l: 'nba', s: 'basketball' }, { l: 'mlb', s: 'baseball' }, { l: 'college-football', s: 'football', g: 80 }, { l: 'mens-college-basketball', s: 'basketball' } ];
            let allLiveGames = []; let allScheduledGames = []; let liveGamesForPage = [];
            const now = new Date(), tomorrow = new Date(now.getTime() + 86400000); const todayStr = now.toISOString().split('T')[0];

            for (const c of configs) { 
                try { 
                    let url = `https://site.api.espn.com/apis/site/v2/sports/${c.s}/${c.l}/scoreboard${c.g?'?groups='+c.g:''}`; 
                    const d = await (await fetch(url)).json(); 
                    d.events.forEach(ev => { 
                        const comp = ev.competitions[0]; const status = comp.status.type;
                        let shouldShow = false; 
                        if (c.l === 'nhl') { if (ev.date.split('T')[0] === todayStr || status.state === 'in') shouldShow = true; } else { if (status.state === 'in' || status.state === 'post' || (new Date(ev.date) > now && new Date(ev.date) < tomorrow)) shouldShow = true; }

                        if (shouldShow) { 
                            const h = comp.competitors[0], a = comp.competitors[1]; 
                            if (status.state === 'in') {
                                let st = ""; if (comp.leaders) { let cats = []; comp.leaders.forEach(cat => { if(cat.leaders) cats.push(`<span><span class="stat-cat">${cat.shortDisplayName}</span> ${cat.leaders[0].athlete.shortName} (${cat.leaders[0].displayValue})</span>`); }); st = `<div class="game-stats">${cats.join('')}</div>`; }
                                allLiveGames.push({ html: `<span class="score-item"><span class="live-pulse">●</span><div class="team-box"><img class="team-logo" src="${a.team.logo}"><span class="team-score">${a.score||'0'}</span></div><span class="vs-label">@</span><div class="team-box"><img class="team-logo" src="${h.team.logo}"><span class="team-score">${h.score||'0'}</span></div><span class="game-status">${comp.status.type.shortDetail}</span>${st}</span>`, league: c.l.toUpperCase() });
                                liveGamesForPage.push({ league: c.l.toUpperCase(), home: h.team.shortDisplayName, homeScore: h.score, homeLogo: h.team.logo, away: a.team.shortDisplayName, awayScore: a.score, awayLogo: a.team.logo, status: comp.status.type.shortDetail, clock: comp.status.displayClock || status.detail, tv: (comp.broadcasts && comp.broadcasts[0]) ? comp.broadcasts[0].names[0] : 'TV TBA' });
                            } else { 
                                const timeDisplay = status.state === 'post' ? 'FINAL' : new Date(ev.date).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
                                allScheduledGames.push({ html: `<span class="score-item"><div class="team-box"><img class="team-logo" src="${a.team.logo}"></div><span class="vs-label">vs</span><div class="team-box"><img class="team-logo" src="${h.team.logo}"></div><span class="game-status" style="color:#00ffff;">${comp.odds?comp.odds[0].details:"LINE TBD"} • ${timeDisplay}</span></span>`, league: c.l.toUpperCase() });
                            } 
                        } 
                    });
                } catch(e) {} 
            }

            areGamesActive = liveGamesForPage.length > 0; globalLiveGamesData = liveGamesForPage;
            const tickerTrack = document.getElementById('ticker-track'); let contentString = "";

            if (allLiveGames.length > 0) {
                const sortedLive = allLiveGames.reduce((acc, game) => { if(!acc[game.league]) acc[game.league] = []; acc[game.league].push(game.html); return acc; }, {});
                contentString += `<div class="live-mode-header"><span class="live-pulse">●</span> LIVE SCORES</div>`;
                for(const [league, games] of Object.entries(sortedLive)) { contentString += `<span class="ticker-section-head">${league}</span>` + games.join(''); }
            } else {
                let newsHtml = ""; try { const newsRes = await fetch(`https://site.api.espn.com/apis/site/v2/sports/football/nfl/news`); const newsD = await newsRes.json(); if(newsD.articles) { newsHtml = newsD.articles.slice(0, 5).map(n => `<span class="news-item"><span class="news-tag">NEWS</span>${n.headline}</span>`).join(''); } } catch(e) {}
                contentString += newsHtml;
                const sortedSched = allScheduledGames.reduce((acc, game) => { if(!acc[game.league]) acc[game.league] = []; acc[game.league].push(game.html); return acc; }, {});
                for(const [league, games] of Object.entries(sortedSched)) { contentString += `<span class="ticker-section-head">${league}</span>` + games.join(''); }
            }

            tickerTrack.innerHTML = contentString + contentString; 
            const distinctItemCount = (allLiveGames.length || (allScheduledGames.length + 5)); 
            const baseDuration = Math.max(40, distinctItemCount * 10); 
            tickerTrack.style.animationDuration = `${baseDuration}s`;
        }
        
        setInterval(updateSportsTicker, 60000); updateSportsTicker();
        nextSlide();
    </script>
</body>
</html>