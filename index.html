<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ahlers Arcade Challenge!</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            min-height: 100vh;
            margin: 0;
            text-align: center;
            padding: 20px;
            overflow: hidden;
            box-sizing: border-box;
        }
        #bg-video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            z-index: -2;
            object-fit: cover;
        }
        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(15, 12, 41, 0.7);
            z-index: -1;
        }
        .container {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            background: rgba(0, 0, 0, 0.6);
            border: 5px solid #ff007f;
            border-radius: 40px;
            padding: 40px;
            box-shadow: 0 0 30px rgba(255, 0, 127, 0.5);
            max-width: 90%;
            width: 100%;
            max-height: 90vh;
            position: relative;
        }
        #fullscreen-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        h1#main-title {
            margin-bottom: 20px;
            flex-shrink: 0;
        }
        #main-title img {
            max-width: 100%;
            max-height: 20vh;
            height: auto;
        }
        #content-container { width: 100%; }
        #qrcode-container { margin-top: 30px; display: flex; flex-direction: column; align-items: center; gap: 20px; }
        #qrcode { background: white; padding: 20px; border-radius: 10px; }
        #qrcode-text { font-size: 2vw; color: #fff; }
        #leaderboard-display { display: flex; flex-direction: column; align-items: center; }
        #leaderboard-title { font-family: 'Bangers', cursive; font-size: 4vw; color: #ff007f; text-shadow: 3px 3px 0 #302b63; }
        #leaderboard-list { list-style-type: none; padding: 0; font-family: 'Press Start 2P', cursive; font-size: 1.8vw; width: 100%; max-height: 40vh; overflow-y: auto; padding-right: 20px; }
        #leaderboard-list li { padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        .ticker-wrap { position: fixed; bottom: 0; left: 0; width: 100%; background-color: #000; border-top: 3px solid #ff007f; padding: 10px 0; overflow: hidden; }
        .ticker { display: inline-block; white-space: nowrap; animation: scroll-ticker 200s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 2rem; color: #00ffff; font-size: 1.5vw; }
        @keyframes scroll-ticker {
            0% { transform: translateX(100vw); }
            100% { transform: translateX(-100%); }
        }
    </style>
</head>
<body>
    <div class="video-overlay"></div>
    
    <video autoplay loop muted playsinline id="bg-video">
        <source src="https://raw.githubusercontent.com/ajersj-cmyk/arcade-challenge/main/background.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <div class="container">
        <button id="fullscreen-btn">ðŸ“º</button>
        <div id="main-display">
            <h1 id="main-title">
                <img src="https://raw.githubusercontent.com/ajersj-cmyk/arcade-challenge/main/header.PNG" alt="Ahlers Arcade Challenge">
            </h1>
            <div id="content-container">
                <div id="idle-display" style="display: flex; flex-direction: column; align-items: center;">
                    <p id="idle-text" style="font-size: 3vw;">Your Adventure Awaits!</p>
                    <div id="qrcode-container">
                        <p id="qrcode-text">Scan to join the game!</p>
                        <div id="qrcode"></div>
                    </div>
                </div>
                <div id="leaderboard-display" style="display: none;">
                    <p id="leaderboard-title"></p>
                    <ul id="leaderboard-list"></ul>
                </div>
            </div>
        </div>
    </div>
    <div class="ticker-wrap">
        <div class="ticker" id="ticker-content"></div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sheetyUrl = "https://script.google.com/macros/s/AKfycbyFS6cG3gCtOp6SLd0HuDSOfjR1vc9hlLCUfI5AHgTttV651hWQr8H4pdHxBI3-eJrx/exec";
            const leaderboardDisplay = document.getElementById('leaderboard-display');
            const leaderboardTitle = document.getElementById('leaderboard-title');
            const leaderboardList = document.getElementById('leaderboard-list');
            const qrCodeDiv = document.getElementById('qrcode');
            const idleDisplay = document.getElementById('idle-display');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const tickerContent = document.getElementById('ticker-content');
            let isShowingLeaderboard = false;

            const tickerMessages = [ "Scan the code to get started!", "Take on our Arcade Challenge to climb the leaderboards!", "Ahlers Arcade Welcomes you! Scan the code, enter your name and get started racking up points!" ];
            let tickerHTML = '';
            for (let i = 0; i < 5; i++) { tickerMessages.forEach(msg => { tickerHTML += `<div class="ticker-item">${msg}</div>`; }); }
            tickerContent.innerHTML = tickerHTML;

            const generateQrCode = (url) => { try { const qr = qrcode(0, 'L'); qr.addData(url); qr.make(); qrCodeDiv.innerHTML = qr.createImgTag(7); } catch (e) { qrCodeDiv.innerHTML = "Error generating QR code."; console.error(e); } };
            const playerPageUrl = "https://ajersj-cmyk.github.io/arcade-challenge/player.html";
            generateQrCode(playerPageUrl);

            const fetchAndDisplayLeaderboard = async () => { try { const response = await fetch(sheetyUrl); if (!response.ok) throw new Error('Failed to fetch data'); const data = await response.json(); const scores = data.sheet1 || []; const playerTotals = {}; scores.forEach(entry => { const name = entry.playername; const score = Number(entry.score) || 0; if (name) { playerTotals[name] = (playerTotals[name] || 0) + score; } }); const sortedPlayers = Object.entries(playerTotals).map(([name, totalScore]) => ({ playername: name, score: totalScore })).sort((a, b) => b.score - a.score); const neonColors = ['#00ffff', '#ff007f', '#00ff7f']; leaderboardTitle.textContent = "High Score Board"; leaderboardList.innerHTML = ''; if (sortedPlayers.length === 0) { leaderboardList.innerHTML = '<li>No scores yet!</li>'; } else { sortedPlayers.forEach((player, index) => { const li = document.createElement('li'); let playerName = player.playername; if (index === 0) { playerName = `ðŸ‘‘ ${playerName}`; } const randomColor = neonColors[Math.floor(Math.random() * neonColors.length)]; li.style.color = randomColor; li.style.textShadow = `0 0 4px ${randomColor}`; li.innerHTML = `<span>${index + 1}. ${playerName}</span><span>${player.score} pts</span>`; leaderboardList.appendChild(li); }); } } catch (error) { console.error('Failed to fetch leaderboard:', error); leaderboardList.innerHTML = `<li>Error loading scores.</li>`; } };
            const cycleDisplay = () => { if (isShowingLeaderboard) { idleDisplay.style.display = 'flex'; leaderboardDisplay.style.display = 'none'; isShowingLeaderboard = false; } else { idleDisplay.style.display = 'none'; leaderboardDisplay.style.display = 'flex'; fetchAndDisplayLeaderboard(); isShowingLeaderboard = true; } };
            fullscreenBtn.addEventListener('click', () => { if (!document.fullscreenElement) { document.documentElement.requestFullscreen(); } else if (document.exitFullscreen) { document.exitFullscreen(); } });
            cycleDisplay();
            setInterval(cycleDisplay, 10000);
        });
    </script>
</body>
</html>